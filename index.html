<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hideable Columns Table</title>
<style>
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
  }
  th {
    background-color: #f2f2f2;
  }
  .modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5);
  }
  .modal-content {
    background-color: #fefefe;
    margin: 20% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
  }
</style>
</head>
<body>

<h2>Hideable Columns Table</h2>

<button onclick="openModal()">Hide/Unhide Columns</button>

<div id="modal" class="modal">
  <div class="modal-content">
    <span onclick="closeModal()" style="float: right; cursor: pointer;">&times;</span>
    <h3>Choose columns to hide:</h3>
    <label><input type="checkbox" name="hide-name"> Name</label><br>
    <label><input type="checkbox" name="hide-email"> Email</label><br>
    <label><input type="checkbox" name="hide-phone"> Phone</label><br>
    <button onclick="applyHide()">Hide</button>
  </div>
</div>

<table id="data-table">
  <thead>
    <tr>
      <th><input type="checkbox" id="toggle-all"></th>
      <th>Name</th>
      <th>Email</th>
      <th>Phone</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><input type="checkbox" class="toggle" name="toggle-0"></td>
      <td>John Doe</td>
      <td>john@example.com</td>
      <td>123-456-7890</td>
    </tr>
    <tr>
      <td><input type="checkbox" class="toggle" name="toggle-1"></td>
      <td>Jane Smith</td>
      <td>jane@example.com</td>
      <td>987-654-3210</td>
    </tr>
  </tbody>
</table>

<script src="settings.js"></script>
<script>
  const toggleAll = document.getElementById('toggle-all');
  const toggles = document.querySelectorAll('.toggle');

  toggleAll.addEventListener('change', function() {
    toggles.forEach(toggle => {
      toggle.checked = toggleAll.checked;
    });
  });

  toggles.forEach(toggle => {
    toggle.addEventListener('change', function() {
      toggleAll.checked = [...toggles].every(t => t.checked);
    });
  });

  function openModal() {
    document.getElementById('modal').style.display = 'block';
    loadCheckboxStatus();
  }

  function closeModal() {
    document.getElementById('modal').style.display = 'none';
  }

  function applyHide() {
    const hideName = document.getElementsByName('hide-name')[0].checked;
    const hideEmail = document.getElementsByName('hide-email')[0].checked;
    const hidePhone = document.getElementsByName('hide-phone')[0].checked;

    const columnSettings = {
      'hide-name': hideName,
      'hide-email': hideEmail,
      'hide-phone': hidePhone
    };

    // Save column visibility settings to the settings file
    saveSettings(columnSettings);

    applyColumnSettings();
    closeModal();
  }

  function applyColumnSettings() {
    const columnSettings = loadSettings();
    
    const table = document.getElementById('data-table');
    const rows = table.rows;

    for (let key in columnSettings) {
      const columnIndex = getColumnIndexByKey(key);
      if (columnIndex !== -1) {
        for (let i = 0; i < rows.length; i++) {
          const cells = rows[i].cells;
          cells[columnIndex].style.display = columnSettings[key] ? 'none' : '';
        }
      }
    }
  }

  function getColumnIndexByKey(key) {
    switch (key) {
      case 'hide-name':
        return 1;
      case 'hide-email':
        return 2;
      case 'hide-phone':
        return 3;
      default:
        return -1;
    }
  }

  function loadCheckboxStatus() {
    const columnSettings = loadSettings();
    toggles.forEach((toggle, index) => {
      const checkboxName = `toggle-${index}`;
      toggle.checked = columnSettings[checkboxName];
    });
  }
</script>

</body>
</html>
